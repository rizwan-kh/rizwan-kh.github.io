<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Rizwan Khan ">
<meta name="description" content="Introduction If you&amp;rsquo;ve been using Azure DevOps, you would know that a pipeline can be trigger with runtime parameters in the format key: value pair and this is great for doing almost all of the tasks.
For our use-case, we had been looking at option to send a JSON based parameter dictionary and I couldn&amp;rsquo;t find any way at the time of writing this article. We came up with a hack to achieve this and I would want to write it up in this blog post." />
<meta name="keywords" content=", azure devops, pipelines" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://rizwan-kh.github.io/azdo/azdo-send-json-request/" />


    <title>
        
            Azure DevOps - Send Json Request/Parameter :: Rizwan Khanüë®üèª‚Äçüíª 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://rizwan-kh.github.io/main.d1ea4af8fd04fb24a4f8b882ea54bd04eb245427ca4baf527c81a5dab071410b.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://rizwan-kh.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://rizwan-kh.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://rizwan-kh.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://rizwan-kh.github.io/site.webmanifest">
    <link rel="mask-icon" href="https://rizwan-kh.github.io/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="https://rizwan-kh.github.io/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">



<meta itemprop="name" content="Azure DevOps - Send Json Request/Parameter">
<meta itemprop="description" content="Introduction If you&rsquo;ve been using Azure DevOps, you would know that a pipeline can be trigger with runtime parameters in the format key: value pair and this is great for doing almost all of the tasks.
For our use-case, we had been looking at option to send a JSON based parameter dictionary and I couldn&rsquo;t find any way at the time of writing this article. We came up with a hack to achieve this and I would want to write it up in this blog post.">
<meta itemprop="datePublished" content="2021-06-21T11:16:23+04:00" />
<meta itemprop="dateModified" content="2021-06-21T11:16:23+04:00" />
<meta itemprop="wordCount" content="638">
<meta itemprop="image" content="https://rizwan-kh.github.io"/>



<meta itemprop="keywords" content="azure devops,pipelines," />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://rizwan-kh.github.io"/>

<meta name="twitter:title" content="Azure DevOps - Send Json Request/Parameter"/>
<meta name="twitter:description" content="Introduction If you&rsquo;ve been using Azure DevOps, you would know that a pipeline can be trigger with runtime parameters in the format key: value pair and this is great for doing almost all of the tasks.
For our use-case, we had been looking at option to send a JSON based parameter dictionary and I couldn&rsquo;t find any way at the time of writing this article. We came up with a hack to achieve this and I would want to write it up in this blog post."/>



    <meta property="og:title" content="Azure DevOps - Send Json Request/Parameter" />
<meta property="og:description" content="Introduction If you&rsquo;ve been using Azure DevOps, you would know that a pipeline can be trigger with runtime parameters in the format key: value pair and this is great for doing almost all of the tasks.
For our use-case, we had been looking at option to send a JSON based parameter dictionary and I couldn&rsquo;t find any way at the time of writing this article. We came up with a hack to achieve this and I would want to write it up in this blog post." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rizwan-kh.github.io/azdo/azdo-send-json-request/" />
<meta property="og:image" content="https://rizwan-kh.github.io"/>
<meta property="article:published_time" content="2021-06-21T11:16:23+04:00" />
<meta property="article:modified_time" content="2021-06-21T11:16:23+04:00" />






    <meta property="article:published_time" content="2021-06-21 11:16:23 &#43;0400 &#43;04" />








    </head>

    <body class="">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://rizwan-kh.github.io/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/rizwan</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#DC143C;
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://rizwan-kh.github.io/resume/">About</a></li><li><a href="https://rizwan-kh.github.io/azdo/">Azure DevOps</a></li><li><a href="https://rizwan-kh.github.io/posts/">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://rizwan-kh.github.io/azdo/azdo-send-json-request/">Azure DevOps - Send Json Request/Parameter</a></h2>

            

            <div class="post-content">
                <h3 id="introduction">Introduction</h3>
<p>If you&rsquo;ve been using Azure DevOps, you would know that a pipeline can be trigger with runtime parameters in the format <code>key: value</code> pair and this is great for doing almost all of the tasks.</p>
<p>For our use-case, we had been looking at option to send a JSON based parameter dictionary and I couldn&rsquo;t find any way at the time of writing this article. We came up with a hack to achieve this and I would want to write it up in this blog post.</p>
<h3 id="flatten-json--operation">Flatten JSON &amp; operation</h3>
<p>Wee look at the option to use the Flatten JSON Objects extension to convert a nested data layer object into a new object with only one layer of key/value pairs. For this we used the <strong>flatten_json</strong> library</p>
<p><code>pip install flatten_json</code></p>
<pre><code>'''
flatten the json data with a '_' separator; you can use different separator as well
'''
# flatten.py
import flatten_json

data = {
    &quot;a&quot;: 1,
    &quot;b&quot;: 2,
    &quot;c&quot;: [{&quot;d&quot;: [2, 3, 4], &quot;e&quot;: [{&quot;f&quot;: 1, &quot;g&quot;: 2}]}]
}
flat_json = flatten_json.flatten(data,'_')
print(flat_json)
'''
the above command gives us below output, which is single layer JSON
{
 'a': 1,
 'b': 2,
 'c_0_d_0': 2,
 'c_0_d_1': 3,
 'c_0_d_2': 4,
 'c_0_e_0_f': 1,
 'c_0_e_0_g': 2
 }
'''
</code></pre><p>Now that we had single layer <code>key: value</code> pair, we added another hack to be able to read these variables properly in Azure DevOps pipeline. We added a prefix (any prefix that&rsquo;s not part of your JSON) <strong>RizwanGotNoChill-</strong></p>
<pre><code>prefixed_flat_json = {f&quot;RizwanGotNoChill-{key}&quot;: val for key, val in flat_json.items()}
print(prefixed_flat_json)
'''
the above command gives us below output, which is single layer prefixed JSON
{
 'RizwanGotNoChill-a': 1,
 'RizwanGotNoChill-b': 2,
 'RizwanGotNoChill-c_0_d_0': 2,
 'RizwanGotNoChill-c_0_d_1': 3,
 'RizwanGotNoChill-c_0_d_2': 4,
 'RizwanGotNoChill-c_0_e_0_f': 1,
 'RizwanGotNoChill-c_0_e_0_g': 2
 }
'''
</code></pre><p>This part if all we needed, now you could use the Azure DevOps Rest API with above <code>key: value</code> pair to trigger any pipeline and I will show, how we intepreted these at the pipeline and crafted a JSON out.</p>
<h3 id="trigger-azure-devops-pipeline">Trigger Azure DevOps Pipeline</h3>
<p>I found the below two ways to trigger a pipeline, you may want to see which one fits your case -</p>
<ul>
<li>Using REST API based curl/http command calling the <strong>build API</strong> - <a href="https://dev.azure.com/YOURORG/YOURPROJECT/_apis/build/builds?api-version=6.1-preview.6">https://dev.azure.com/YOURORG/YOURPROJECT/_apis/build/builds?api-version=6.1-preview.6</a>)</li>
</ul>
<ol>
<li>Convert you JSON to an escaped one using this <a href="https://jsonformatter.org/json-escape">link</a></li>
<li>Create the request param as below and send</li>
</ol>
<pre><code># Replace the values for YOURORG, YOURPROJECT, PATTOKEN and the value for id(pipeline ID)
curl --request POST \
  --url 'https://dev.azure.com/YOURORG/YOURPROJECT/_apis/build/builds?api-version=6.1-preview.6' \
  --header 'Authorization: Basic PATTOKEN' \
  --header 'Content-Type: application/json' \

  --data '{
    &quot;parameters&quot;: &quot;{\&quot;RizwanGotNoChill-a\&quot;:1,\&quot;RizwanGotNoChill-b\&quot;:2,\&quot;RizwanGotNoChill-c_0_d_0\&quot;:2,\&quot;RizwanGotNoChill-c_0_d_1\&quot;:3,\&quot;RizwanGotNoChill-c_0_d_2\&quot;:4,\&quot;RizwanGotNoChill-c_0_e_0_f\&quot;:1,\&quot;RizwanGotNoChill-c_0_e_0_g\&quot;:2}&quot;,
    &quot;definition&quot;:  { &quot;id&quot;:  27 }
}'
</code></pre><ul>
<li>The other way to trigger a pipeline is calling the <strong>RunPipeline API</strong>, I wrote a small program</li>
</ul>
<script type="application/javascript" src="https://gist.github.com/rizwan-kh/c08955a24bfc1eb3eaa48248acd012e0.js"></script>

<h3 id="unflatten-json--operation">Unflatten JSON &amp; operation</h3>
<p>Now the baton is at the Azure DevOps end to decode and re-configure this as a JSON, I used a simple job and Python script to achieve this</p>
<pre><code># azure-pipeline.yml
- job: install_library
  steps:
  - checkout: none
  - script: |
      pip3 install flatten_json
      pip3 freeze
      displayName: Install python library

- job: generate_files
  steps:
  - script: |
      echo &quot;Here, we will grep the content based on the prefix and store in a file&quot;
      env | grep RizwanGotNoChill &gt; request.txt
      sed -i 's/RizwanGotNoChill-//' request.txt
      echo &quot;utils.py first creates a dict based on request.txt and then unflattens the files and write to request.json&quot;
      python3 utils.py
      cat request.json | jq .
</code></pre><pre><code># utils.py
import os, sys
import json
import flatten_json

dict_from_file = {}
with open(&quot;request.txt&quot;) as fp:
    for line in fp:
        (key, val) = line.split(&quot;=&quot;)
        dict_from_file[key.lower()] = val.rstrip(&quot;\n&quot;)
print(dict_from_file)

request_json = flatten_json.unflatten(dict_from_file, '-')
print(request_json)

with open('request.json', 'w') as fp:
     fp.write(json.dumps(request_json))

</code></pre><p>Here our <code>request.json</code> is a proper JSON file ready to be used by any application/program in our Azure Pipeline;
We noticed one issue though, the conversion process, converts all other data types to string data-type, so might be you would need to change that or add some logic to create json/dict with type safe.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://rizwan-kh.github.io/tags/azure-devops">azure devops</a></span><span class="tag"><a href="https://rizwan-kh.github.io/tags/pipelines">pipelines</a></span>
  				</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            
                <span><a href="https://rizwan-kh.github.io">Rizwan Khan</a></span>
            
            
                <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            
            <span> <a href="https://rizwan-kh.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Customize with &#10084; by <a href="https://rizwan-kh.github.io/">Rizwan Khan</a></span>
          </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://rizwan-kh.github.io/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-198799391-1', 'auto');
	
	ga('send', 'pageview');
}
</script>




    </body>
</html>
